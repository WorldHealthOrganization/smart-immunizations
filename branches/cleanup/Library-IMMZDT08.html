<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>IMMZDT08 - WHO Immunization Implementation Guide v0.1.0</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link rel="stylesheet" href="fhir.css"/>

      <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap-fhir.css"/>

      <!-- Project extras -->
    <link rel="stylesheet" href="assets/css/project.css"/>
    <link rel="stylesheet" href="assets/css/pygments-manni.css"/>
    <link rel="stylesheet" href="assets/css/jquery-ui.css"/>
  	<link rel="stylesheet" href="assets/css/prism.css"/>
      <!-- Placeholder for child template CSS declarations -->
    <link rel="stylesheet" href="assets/css/who.css"/>
    <link rel="stylesheet" href="assets/css/lforms.min.css"/>

    <script src="fhir-table-scripts.js" type="text/javascript"> </script>

      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- [if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif] -->

      <!-- Favicons -->
    <link sizes="144x144" rel="fhir-logo" href="assets/ico/icon-fhir-144.png"/>
    <link sizes="114x114" rel="fhir-logo" href="assets/ico/icon-fhir-114.png"/>
    <link sizes="72x72" rel="fhir-logo" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"5.12"}
    h3,h4,h5,h6{--heading-prefix:"5.12"}</style>
    <div id="segment-header" class="segment">    <!-- segment-header -->
      <div class="container">    <!-- container -->
          <!-- Placeholder for child template header declarations -->


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">WHO Immunization Implementation Guide</span>
            <br/>
            <span style="display:inline-block;">0.1.0 - CI Build



  <img src="assets/images/001.svg" alt="International flag" title="International" height="16"/>


            </span>
          </p>
        </div>
      </div>   <!-- /container -->
    </div>    <!-- /segment-header -->

    <div id="segment-navbar" class="segment">    <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">    <!-- container -->
          <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
            <!-- status-bar -->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a href="http://hl7.org/fhir/R4/index.html" class="navbar-brand hidden">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <ul class="nav navbar-nav">
  
  <li class="dropdown">
    <a data-toggle="dropdown" href="index.html" class="dropdown-toggle">Home<b class="caret"></b></a>
    <ul class="dropdown-menu">
      <li><a href="index.html">Summary</a></li>
      <li><a href="changes.html">Changes</a></li>
      <li><a href="dependencies.html">Dependencies</a></li>
      <li><a href="references.html">References</a></li>
      <li><a href="adapting.html">Adapting Guidelines for Country Use</a></li>
    </ul>
  </li>
 
 <li class="dropdown">
    <a data-toggle="dropdown" href="business-requirements.html" class="dropdown-toggle">Business Requirements<b class="caret"></b></a>
    <ul class="dropdown-menu">
      <li><a href="concepts.html">Concepts</a></li>
      <li><a href="personas.html">Generic Personas</a></li>
      <li><a href="scenarios.html">User Scenarios</a></li>
      <li><a href="business-processes.html">Business Processes</a></li>
      <li><a href="dictionary.html">Data Dictionary</a></li>
      <li><a href="decision-logic.html">Decision-support Logic</a></li>
      <li><a href="indicators.html">Indicator and Performance Metrics</a></li>
      <li><a href="functional-requirements.html">Functional Requirements</a></li>    
      <li><a href="non-functional-requirements.html">Non-functional Requirements</a></li>
    </ul>
  </li>

  <li class="dropdown">
    <a data-toggle="dropdown" href="data-models-and-exchange.html" class="dropdown-toggle">Data Models and Exchange<b class="caret"></b></a>
    <ul class="dropdown-menu">
      <li><a href="system-actors.html">System Actors</a></li>
      <li><a href="sequence-diagrams.html">Sequence Diagrams</a></li>
      <li><a href="transactions.html">Transactions</a></li>
      <li><a href="indicators-measures.html">Indicators and Measures</a></li>
      <li><a href="codings.html">Codings</a></li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="deployment.html" class="dropdown-toggle"> Deployment<b class="caret"></b></a>
    <ul class="dropdown-menu">
      <li><a href="security-privacy.html">Security and Privacy Considerations</a></li>
      <li><a href="testing.html">Testing</a></li>
      <li><a href="test-data.html">Test Data</a></li>
      <li><a href="reference-implementations.html">Reference Implementations</a></li>
      <li><a href="downloads.html">Downloads</a></li>
    </ul>
  </li>

  <li class="dropdown">
    <a data-toggle="dropdown" href="deployment.html" class="dropdown-toggle"> Indices<b class="caret"></b></a>
    <ul class="dropdown-menu">
      <li><a href="artifacts.html">Artifact Index</a></li>
        <!-- <li><a href="maps.html">Mappings</a></li> -->
    </ul>
  </li>
</ul>

            </div>    <!-- /.nav-collapse -->
          </div>    <!-- /.container -->
        </nav>    <!-- /.navbar -->
        <!-- /HEADER CONTENT -->
      </div>    <!-- /container -->
    </div>    <!-- /segment-navbar -->
      <!-- status-bar -->

    <div id="segment-breadcrumb" class="segment">    <!-- segment-breadcrumb -->
      <div class="container">    <!-- container -->
        <ul class="breadcrumb">
          <li><a href="toc.html"><b>Table of Contents</b></a></li><li><a href="artifacts.html"><b>Artifacts Summary</b></a></li><li><b>IMMZDT08</b></li>

        </ul>
      </div>    <!-- /container -->
    </div>    <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">    <!-- segment-content -->
      <div class="container">    <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<div class="col-12">
    <!-- ReleaseHeader --><p id="publish-box">WHO Immunization Implementation Guide, published by World Health Organization (WHO). This is not an authorized publication; it is the continuous build for version 0.1.0). This version is based on the current content of <a href="https://github.com/WorldHealthOrganization/smart-immunizations">https://github.com/WorldHealthOrganization/smart-immunizations</a> and changes regularly. See the <a href="http://fhir.org/guides/who/smart-immunization/history.html">Directory of published versions</a></p>  <!-- EndReleaseHeader -->
  








<ul class="nav nav-tabs">

  <li class="active">
    <a href="#">Narrative Content</a>
  </li>



  
    <li>
      <a href="Library-IMMZDT08.xml.html">XML</a>
    </li>
  


  
    <li>
      <a href="Library-IMMZDT08.json.html">JSON</a>
    </li>
  


  
    <li>
      <a href="Library-IMMZDT08.ttl.html">TTL</a>
    </li>
  



</ul>

  <a name="root"> </a>

  <h2 id="root">Library: IMMZDT08

  </h2>

  <table class="colsd">

    <tr>
      <td colspan="4"><i>Official URL</i>: <span class="copy-text">http://fhir.org/guides/who/smart-immunization/Library/IMMZDT08<button data-clipboard-text="http://fhir.org/guides/who/smart-immunization/Library/IMMZDT08" title="Click to copy URL" class="btn-copy"/></span>
      </td>
      <td><i>Version</i>:
      <span class="copy-text">0.1.0<button data-clipboard-text="http://fhir.org/guides/who/smart-immunization/Library/IMMZDT08|0.1.0" title="Click to copy versioned URL" class="btn-copy"/></span>
      </td>
    </tr>

    <tr>







      <td colspan="4">
        
          Draft
          
            as of 2023-10-05
          
        
      </td>



      <td><i>Computable Name</i>: <span style="font-family: monospace;">IMMZDT08</span></td>
    </tr>




  </table>



    <!-- insert intro if present -->
  



  <!-- <p>
  Formats: <a href="Library-IMMZDT08.xml.html">XML</a>, <a href="Library-IMMZDT08.json.html">JSON</a>, <a href="Library-IMMZDT08.ttl.html">Turtle</a>
  </p> -->

  


  <div><h2>Related Artifacts</h2><table class="grid"><tr><td>depends-on</td><td>FHIR model information</td><td><code>http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1</code></td></tr><tr><td>depends-on</td><td>Library FHIRHelpers</td><td><code>http://fhir.org/guides/who/smart-immunization/Library/FHIRHelpers|4.0.1</code></td></tr><tr><td>depends-on</td><td>Library IMMZCom</td><td><a href="Library-IMMZCommon.html">IMMZCommon</a></td></tr><tr><td>depends-on</td><td>Library IMMZc</td><td><a href="Library-IMMZConcepts.html">IMMZConcepts</a></td></tr><tr><td>depends-on</td><td>Library IMMZCon</td><td><a href="Library-IMMZConfig.html">IMMZConfig</a></td></tr><tr><td>depends-on</td><td>Library IMMZvl</td><td><a href="Library-IMMZVaccineLibrary.html">IMMZVaccineLibrary</a></td></tr><tr><td>depends-on</td><td>Library FC</td><td><a href="Library-FHIRCommon.html">FHIRCommon</a></td></tr><tr><td>depends-on</td><td>Library Wcon</td><td><a href="Library-WHOConcepts.html">WHOConcepts</a></td></tr><tr><td>depends-on</td><td>Library WCom</td><td><a href="Library-WHOCommon.html">WHOCommon</a></td></tr><tr><td>depends-on</td><td>Value set Pregnancy Status Pregnant</td><td><a href="ValueSet-pregnancystatuspregnant-values.html">Pregnancy status pregnant values</a></td></tr><tr><td>depends-on</td><td>Value set MCV Vaccine</td><td><a href="ValueSet-IMMZ.A1.DE9.html">Measles</a></td></tr><tr><td>depends-on</td><td>Value set HIV status</td><td><a href="ValueSet-HIVstatus-values.html">HIV status values</a></td></tr><tr><td>depends-on</td><td>Value set HIV status - HIV positive Choices</td><td><a href="ValueSet-anc-b9-de46.html">HIV status - HIV positive Choices</a></td></tr><tr><td>depends-on</td><td>Value set ARV Drugs</td><td><a href="ValueSet-ARVDrugs-values.html">ARV Drugs values</a></td></tr><tr><td>depends-on</td><td>Value set Live Attenuated</td><td><code>http://fhir.org/guides/who/smart-immunization/ValueSet/LiveAttenduatedVaccines</code></td></tr></table><h2>Parameters</h2><table class="grid"><tr><td>Individual is at high risk of contracting measles</td><td>in</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Individual is travelling to a country experiencing measles outbreaks</td><td>in</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Individual is known to be HIV-infected or exposed</td><td>in</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Immune reconstitution was achieved</td><td>in</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Patient</td><td>out</td><td>0</td><td>1</td><td>Patient</td></tr><tr><td>MCV Dose Contraindicated</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>MCV Doses Administered to Patient</td><td>out</td><td>0</td><td>*</td><td>Immunization</td></tr><tr><td>High Transmission Setting</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>First MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>Immunization</td></tr><tr><td>Date First MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Second MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>Immunization</td></tr><tr><td>Date Second MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Supplementary MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>Immunization</td></tr><tr><td>Needs Supplementary MCV Dose</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Provision of the MCV dose</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>No MCV Doses Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Needs Birth MCV Dose</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Expected Due Date for MCV dose</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Schedule Due Date for MCV dose</td><td>out</td><td>0</td><td>1</td><td>dateTime</td></tr><tr><td>Birth MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>Immunization</td></tr><tr><td>MCV Next Dose Number</td><td>out</td><td>0</td><td>1</td><td>Resource</td></tr><tr><td>Number of Required MCV Doses</td><td>out</td><td>0</td><td>1</td><td>integer</td></tr><tr><td>Expiration Date for MCV dose</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Overdue Date for MCV dose</td><td>out</td><td>0</td><td>1</td><td>Resource</td></tr><tr><td>Date Supplementary MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Date Birth MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Date Last Valid MCV Dose</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Should vaccinate patient for MCV</td><td>out</td><td>0</td><td>1</td><td>boolean</td></tr><tr><td>Date Last MCV Dose Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>date</td></tr><tr><td>Number of MCV Doses Administered to Patient</td><td>out</td><td>0</td><td>1</td><td>integer</td></tr></table><h2>Data Requirements</h2><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/patient.html">Patient</a> (<a href="http://hl7.org/fhir/R4/patient.html">Patient</a>)</td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/observation.html">Observation</a> (<a href="http://hl7.org/fhir/R4/observation.html">Observation</a>)</td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/observation.html">Observation</a> (<a href="http://hl7.org/fhir/R4/observation.html">Observation</a>)</td></tr><tr style="background-color: #efefef"><td>Filter</td><td>Value</td></tr><tr><td>code</td><td>In ValueSet <a href="ValueSet-HIVstatus-values.html">HIV status values</a></td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/condition.html">Condition</a> (<a href="http://hl7.org/fhir/R4/condition.html">Condition</a>)</td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/immunization.html">Immunization</a> (<a href="http://hl7.org/fhir/R4/immunization.html">Immunization</a>)</td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/medication.html">Medication</a> (<a href="http://hl7.org/fhir/R4/medication.html">Medication</a>)</td></tr></table><table class="grid"><tr><td colspan="2"><b>Type</b>: <a href="http://hl7.org/fhir/R4/medicationadministration.html">MedicationAdministration</a> (<a href="http://hl7.org/fhir/R4/medicationadministration.html">MedicationAdministration</a>)</td></tr></table><h2>Contents</h2><p><code>text/cql</code></p><pre><code class="language-sql">/*
 * Library: IMMZDT08 (IMMZ.DT.08.Measles)
 * Rule: If the child or patient has not been given MCV1 (at 9 months) and MCV2 (between 15-18 months) vaccination 
 * Trigger: Patient has never received measles vaccination
 */
library IMMZDT08
// Start Skeleton CQL
using FHIR version '4.0.1'
include FHIRHelpers version '4.0.1'
include IMMZCommon called IMMZCom
include IMMZConcepts called IMMZc
include IMMZConfig called IMMZCon
include IMMZVaccineLibrary called IMMZvl
include FHIRCommon called FC

parameter "Individual is at high risk of contracting measles" Boolean default false
parameter "Individual is travelling to a country experiencing measles outbreaks" Boolean default false
parameter "Individual is known to be HIV-infected or exposed" Boolean default false
parameter "Immune reconstitution was achieved" Boolean default false

// End Skeleton CQL
context Patient


/**
 * @dataElement Should provision MCV Dose
 */
define "Provision of the MCV dose":
	not("MCV Dose Contraindicated") 
  and if exists(IMMZCom."Live Attenuated Vaccines") then IMMZCom."Date of Latest Live Attenuated Vaccine" + 4 weeks &lt;= Now() else true
	and (
		"Second MCV Dose Administered to Patient" is null or
		(
			"Needs Supplementary MCV Dose" and "Supplementary MCV Dose Administered to Patient" is null
		)
	)
	and IMMZCom."Current Patient Age In Years" &lt; 15

define "Schedule Due Date for MCV dose":
	if IMMZCom."Date of Latest Live Attenuated Vaccine" is null or "Expected Due Date for MCV dose" &gt; IMMZCom."Date of Latest Live Attenuated Vaccine" + 4 weeks
	then "Expected Due Date for MCV dose"
	else IMMZCom."Date of Latest Live Attenuated Vaccine" + 4 weeks

define "Expected Due Date for MCV dose":
	case 
	when "Needs Birth MCV Dose"
		then Patient.birthDate + 6 months
	when "No MCV Doses Administered to Patient"
		then if "High Transmission Setting" then Patient.birthDate + 9 months else Patient.birthDate + 12 months
	when "Second MCV Dose Administered to Patient" is not null and "Needs Supplementary MCV Dose"
		then "Date Second MCV Dose Administered to Patient" + 4 weeks
	when "First MCV Dose Administered to Patient" is not null
		then Patient.birthDate + 15 months
	else null
	end


define "MCV Next Dose Number":
	if "Needs Birth MCV Dose" or "Birth MCV Dose Administered to Patient" is not null
	then 
		case 
		when "Second MCV Dose Administered to Patient" is not null and "Needs Supplementary MCV Dose" then 'booster'
		when "First MCV Dose Administered to Patient" is not null then 3
		when "Birth MCV Dose Administered to Patient" is not null then 2
		else 1
		end
	else
		case 
		when "Second MCV Dose Administered to Patient" is not null and "Needs Supplementary MCV Dose" then 'booster'
		when "First MCV Dose Administered to Patient" is not null then 2
		else 1
		end

define "Number of Required MCV Doses":
	if "Needs Birth MCV Dose" or "Birth MCV Dose Administered to Patient" is not null
	then 3
	else 2

define "Expiration Date for MCV dose":
	case
	when "Needs Birth MCV Dose"
		then Patient.birthDate + 9 months
	else null
	end

define "Overdue Date for MCV dose":
	null

define "Date Last Valid MCV Dose":
	case 
	when "Supplementary MCV Dose Administered to Patient" is not null then "Date Supplementary MCV Dose Administered to Patient"
	when "Second MCV Dose Administered to Patient" is not null then "Date Second MCV Dose Administered to Patient"
	when "First MCV Dose Administered to Patient" is not null then "Date First MCV Dose Administered to Patient"
	when "Birth MCV Dose Administered to Patient" is not null then "Date Birth MCV Dose Administered to Patient"
	else null
	end

define "Should vaccinate patient for MCV":
	"Provision of the MCV dose" and ("Schedule Due Date for MCV dose" &lt;= (Now()))

define "MCV Dose Contraindicated":
	IMMZCom."Pregnant"

/**
 * @dataElement MCV containing Doses Administered to Patient
 */
define "MCV Doses Administered to Patient":
  IMMZCom."Doses Administered to Patient" I
  where
    I.vaccineCode in IMMZc."MCV Vaccine"

/**
 * @define The patient has no MCV doses administered
 */
define "No MCV Doses Administered to Patient":
  not exists("MCV Doses Administered to Patient")


/** 
 * @dataElement Date of last MCV dose administration
 */
define "Date Last MCV Dose Administered to Patient":
  date from (First("MCV Doses Administered to Patient").occurrence as FHIR.dateTime)

/**
 * @define The number of MCV doses administerd to the patient
 */
define "Number of MCV Doses Administered to Patient":
  Count("MCV Doses Administered to Patient")

define "High Transmission Setting":
	(
		IMMZCon."Country currently has a measles outbreak" or
		IMMZCon."In a setting where the risk of measles among infants &lt; 9 months of age remains high" or
		IMMZCon."Population is in conflict zones internally displaced populations and refugees" or 
		"Individual is at high risk of contracting measles" or
		"Individual is travelling to a country experiencing measles outbreaks" or
		"Individual is known to be HIV-infected or exposed"
	)

define "Needs Birth MCV Dose":
	"No MCV Doses Administered to Patient" 
	  and (
			if "High Transmission Setting" 
			then IMMZCom."Current Patient Age In Months" between 6 and 9 
			else IMMZCom."Current Patient Age In Months" between 6 and 12
		)
		and IMMZCom."Date of Latest Live Attenuated Vaccine" +4 weeks &lt;= Now()
		and 
			(
				(
					IMMZCom."HIV Status" in IMMZc."HIV status - HIV positive Choices" 
					  and (
					    not(IMMZCom."Patient is receiving HAART")
							or "Immune reconstitution was achieved"
						)
				)
				or "Individual is known to be HIV-infected or exposed"
			)

define "Needs Supplementary MCV Dose":
	IMMZCom."HIV Status" in IMMZc."HIV status - HIV positive Choices" 
	and IMMZCom."Current Patient Age In Years" &lt; 15
	and IMMZCom."Patient is receiving HAART"
	and "Immune reconstitution was achieved" 
	and "Supplementary MCV Dose Administered to Patient" is null
	and IMMZCom."Date of Latest Live Attenuated Vaccine" +4 weeks &lt;= Now()


/**
 * @dataElement Birth MCV dose given to Patient
 */
define "Birth MCV Dose Administered to Patient":
	Last("MCV Doses Administered to Patient" I where I.occurrence between Patient.birthDate + 6 months and Patient.birthDate + 9 months)

/**
 * @dataElement Date Birth MCV dose administered
 */
define "Date Birth MCV Dose Administered to Patient":
  date from ("Birth MCV Dose Administered to Patient".occurrence as FHIR.dateTime)

/**
 * @dataElement First MCV dose given to Patient
 */
define "First MCV Dose Administered to Patient":
	if "High Transmission Setting"
	then Last("MCV Doses Administered to Patient" I where I.occurrence after Patient.birthDate + 9 months)
	else Last("MCV Doses Administered to Patient" I where I.occurrence after Patient.birthDate + 12 months)
/**
 * @dataElement Date first MCV dose administered
 */
define "Date First MCV Dose Administered to Patient":
  date from ("First MCV Dose Administered to Patient".occurrence as FHIR.dateTime)

/**
 * @dataElement "Second MCV Dose Administered to Patient"
 * only valid if 4 weeks after first dose
 */
define "Second MCV Dose Administered to Patient":
  Last("MCV Doses Administered to Patient" I 
		where I.occurrence after "Date First MCV Dose Administered to Patient" + 4 weeks 
			and I.occurrence after Patient.birthDate + 15 months)

/**
 * @dataElement Date second MCV dose administered
 */
define "Date Second MCV Dose Administered to Patient":
  date from ("Second MCV Dose Administered to Patient".occurrence as FHIR.dateTime)

/**
 * @dataElement "Second MCV Dose Administered to Patient"
 * only valid if 4 weeks after first dose
 */
define "Supplementary MCV Dose Administered to Patient":
  Last("MCV Doses Administered to Patient" I where I.occurrence after "Date Second MCV Dose Administered to Patient")

/**
 * @dataElement Date second MCV dose administered
 */
define "Date Supplementary MCV Dose Administered to Patient":
  date from ("Supplementary MCV Dose Administered to Patient".occurrence as FHIR.dateTime)

/*
 * Rule: Should vaccinate patient for measles (Supplementary) because no doses
 * Annotations:
 * 	 - Provide measles immunization Supplementary dose - Using the "MCV0 Vaccine immunization - NO Previous" schedule (Supplementary dose zero)
 * 	 - 
 * Outputs:
 * 	 - Immunize patient for Measles - No doses
 * 	 - 
 * References:
 * 	- WHO recommendations for routine immunization - summary tables: https://www.who.int/teams/immunization-vaccines-and-biologicals/policies/who-recommendations-for-routine-immunization---summary-tables
 * 	- 
 * Logic:
 *	 ((((((((((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("HIV Status" = "Positive" = true)) and ("Current Patient Age in Months" &lt; 9)) and ("Patient is receiving HAART" = false)) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("Country currently has a measles outbreak" = true)) and ("Current Patient Age in Months" &lt; 9))) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("In a setting where the risk of measles among infants &lt; 9 months of age remains high" = true)) and ("Current Patient Age in Months" &lt; 9))) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("Population is in conflict zones internally displaced populations and refugees" = true)) and ("Current Patient Age in Months" &lt; 9))) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("Individual is at high risk of contracting measles (e.g. contacts of known measles cases or in settings with increased risk of exposure during outbreaks suck as day-care facilities" = true)) and ("Current Patient Age in Months" &lt; 9))) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("Individual is travelling to a country experiencing measles outbreaks" = true)) and ("Current Patient Age in Months" &lt; 9))) or (((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt; 6)) and ("Individual is known to be HIV-infected or exposed (i.e. born to an HIV-infected woman" = true)) and ("Current Patient Age in Months" &lt; 9)))
 */
 /*
define "Should vaccinate patient for measles (Supplementary) because no doses":
	IMMZCom."No MCV Doses Administered to Patient" and 
	(
		IMMZCom."Current Patient Age In Months" between 6 and 9 and
		(
			(
				IMMZCom."HIV Status" in IMMZc."HIV status - HIV positive Choices" and
				not(IMMZCom."Patient is receiving HAART")
			)
			or 
			(
				IMMZCon."Country currently has a measles outbreak" or
				IMMZCon."In a setting where the risk of measles among infants &lt; 9 months of age remains high" or
				IMMZCon."Population is in conflict zones internally displaced populations and refugees" or 
				"Individual is at high risk of contracting measles" or
				"Individual is travelling to a country experiencing measles outbreaks" or
				"Individual is known to be HIV-infected or exposed"
			)
		)
	)
*/

/*
 * Rule: Should vaccinate patient for measles because no doses in a 2 dose scheme
 * Annotations:
 * 	 - Provide measles immunization 1st dose - Using the "MCV1 Vaccine immunization - NO Previous" schedule (2 doses scheme)
 * 	 - 
 * Outputs:
 * 	 - Immunize patient for Measles - No doses
 * 	 - 
 * References:
 * 	- WHO recommendations for routine immunization - summary tables: https://www.who.int/teams/immunization-vaccines-and-biologicals/policies/who-recommendations-for-routine-immunization---summary-tables
 * 	- 
 * Logic:
 *	 ((((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt;= 9)) and ("In a setting where there is high transmission of Measles" = true)) and ("Pregnancy Status" = false)) or ((("Measles vaccine immunization history" = "No-doses" = true) and ("Current Patient Age in Months" &gt;= 12)) and ("In a setting where there is low transmission of Measles" = true)))
 */
 /*
define "Should vaccinate patient for measles because no doses in a 2 dose scheme":
	IMMZCom."No MCV Doses Administered to Patient" and not(IMMZCom."Pregnant") and
	(
		(
			IMMZCom."Current Patient Age In Months" &gt;= 9 and
			IMMZCon."In a setting where there is high transmission of Measles"
		) or (
			IMMZCom."Current Patient Age In Months" &gt;= 12 and
			IMMZCon."In a setting where there is low transmission of Measles"
		)
	)
*/

/*
 * Rule: Should vaccinate patient for measles because 1 dose in a 2 dose scheme
 * Annotations:
 * 	 - Provide measles immunization 1st dose - Using the "MCV2 Vaccine immunization - 1 Previous" schedule (2 doses scheme)
 * Outputs:
 * 	 - Immunize patient for Measles - 1 Dose
 * References:
 * 	- WHO recommendations for routine immunization - summary tables: https://www.who.int/teams/immunization-vaccines-and-biologicals/policies/who-recommendations-for-routine-immunization---summary-tables
 * Logic:
 *	 (((("Measles vaccine immunization history" = "1-dose" = true) and ("Current Patient Age in Months" &gt;= 15)) and ("Date last Measles dose given" &gt;= "4 weeks")) and ("Pregnancy Status" = false))
 */
 /*
define "Should vaccinate patient for measles because 1 dose in a 2 dose scheme":
	IMMZCom."Number of MCV Doses Administered to Patient" = 1 and
	IMMZCom."Current Patient Age In Months" &gt;= 15 and
	IMMZCom."Date Last MCV Dose Administered to Patient" more than 4 'week' before Today() and
	not (IMMZCom."Pregnant")
*/

/*
 * Rule: Should vaccinate patient for measles Supplementary dose because HIV positive and started HAART
 * Annotations:
 * 	 - Provide measles immunization Supplementary dose - Using the "MCV Vaccine immunization" schedule (additional Supplementary dose)
 * 	 - 
 * Outputs:
 * 	 - Immunize patient for Measles Supplementary
 * 	 - 
 * References:
 * 	- WHO recommendations for routine immunization - summary tables: https://www.who.int/teams/immunization-vaccines-and-biologicals/policies/who-recommendations-for-routine-immunization---summary-tables
 * 	- 
 * Logic:
 *	 ((((("HIV Status" = "Positive" = true) and ("Patient is receiving HAART" = true)) and ("Immune reconstitution was achieved" = true)) and ("Pregnancy Status" = false)) or (((((("HIV Status" = "Positive" = true) and ("Patient is receiving HAART" = true)) and ("CD4+ T Lymphocyte monitoring is available" = false)) and ("Time since HAART was initiated in Months" &gt;= 6)) and ("Time since HAART was initiated in Months" &lt;= 12)) and ("Pregnancy Status" = false)))
 */
 /*
define "Should vaccinate patient for measles Supplementary dose because HIV positive and started HAART":
	not(IMMZCom."Pregnant") and
	IMMZCom."HIV Status" in IMMZc."HIV status - HIV positive Choices" and
	IMMZCom."Patient is receiving HAART" and 
	(

		"Immune reconstitution was achieved" or
		not exists(IMMZCom."Observed CD4% Measurements")
		and IMMZCom."Patient HAART Treatment Started 6 to 12 Months Ago"
	)
*/
</code></pre><p><code>Content not shown - (</code><code>application/elm+xml</code>, size = 111Kb)</p><p><code>Content not shown - (</code><code>application/elm+json</code>, size = 200Kb)</p></div>

    <!-- insert notes if present -->
  



  

</div>
        </div>    <!-- /inner-wrapper -->
      </div>    <!-- /row -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-content -->

  <script src="assets/js/jquery.js" type="text/javascript"> </script>       <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script src="assets/js/jquery-ui.min.js" type="text/javascript"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div igtool="footer" id="segment-footer" class="segment">    <!-- segment-footer -->
    <div class="container">    <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &copy; 2021+ <a style="color:var(--footer-hyperlink-text-color)" href="https://www.who.int">World Health Organization (WHO)</a>.  Package who.fhir.immunization#0.1.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Thu, Oct 5, 2023 20:44+0000">2023-10-05</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"><a name="l1065">​</a>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
| <a style="color: #81BEF7" href="http://fhir.org/guides/who/smart-immunization/history.html" target="_blank">Version History</a> | <a rel="license" style="color: #81BEF7" href="license.html">License</a>
          </span>
        </p>
      </div>    <!-- /inner-wrapper -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">    <!-- segment-post-footer -->
    <div class="container">    <!-- container -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-post-footer -->
  
    <!-- JS and analytics only. -->
    <!-- Bootstrap core JavaScript
  ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  <script src="assets/js/bootstrap.min.js" type="text/javascript"> </script>
  <script src="assets/js/respond.min.js" type="text/javascript"> </script>
  <script src="assets/js/anchor.min.js" type="text/javascript"> </script>
  <script src="assets/js/clipboard.min.js" type="text/javascript"> </script>
  <script src="assets/js/clipboard-btn.js" type="text/javascript"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
  <!-- feedback form - Google forms -->
  <!-- v0.1, 2021-01-09 -->



  <!-- / feedback form -->

    <!-- Analytics Below
  ================================================== -->
  </body>
</html>